scale_y_continuous(
name = "CD127",
breaks = logicle_y(c(-1000, -200, -100, 0, 100, 200, 500, 1000, 5000, 10000)),
labels = c("-1000", "-200", "-100", "0", "100", "200", "500", "1000", "5000", "10000"),
limits = logicle_y(c(-200, 550))    # 设置显示范围
) +
scale_color_manual(
values = c("Negative" = "#808080",
"Positive" = "#ed5736")
) +
labs(title = "Type 1 marker") +
theme_classic()
pdf(file = "E:/FlowReview/FigQC_forsig/type1.pdf",width = 8,height = 4.5)
print(p)
dev.off()
pdf(file = "E:/FlowReview/FigQC_forsig/type1.pdf",width = 6,height = 4.5)
print(p)
dev.off()
generate_points <- function(n, mean_x, sd_x, mean_y, sd_y, group_name) {
x <- rnorm(n, mean = mean_x, sd = sd_x)
y <- rnorm(n, mean = mean_y, sd = sd_y)
data.frame(x = x, y = y, Population = group_name)
}
set.seed(42)
group1 <- generate_points(n = 10000, mean_x = 0, sd_x = 100, mean_y = 100, sd_y = 100, group_name = "Negative")
# #type 1
# group2 <- generate_points(n = 1000, mean_x = 700, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
#type 2
group2 <- generate_points(n = 1000, mean_x = 300, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
data <- rbind(group1, group2)
#logicle transform
logicle_x <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
logicle_y <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
data$x_trans <- logicle_x(data$x)
data$y_trans <- logicle_y(data$y)
p = ggplot(data, aes(x = x_trans, y = y_trans, color = Population)) +
geom_point(alpha = 0.5, size = 1) +
scale_x_continuous(
name = "CD25",
breaks = logicle_x(c(-1000, -300, -100, 0, 100, 500, 700, 1000, 2000, 10000)),
labels = c("-1000", "-300",  "-100", "0", "100", "500", "700", "1000", "2000", "10000"),
limits = logicle_x(c(-300, 1000))  # 设置显示范围
) +
scale_y_continuous(
name = "CD127",
breaks = logicle_y(c(-1000, -200, -100, 0, 100, 200, 500, 1000, 5000, 10000)),
labels = c("-1000", "-200", "-100", "0", "100", "200", "500", "1000", "5000", "10000"),
limits = logicle_y(c(-200, 550))    # 设置显示范围
) +
scale_color_manual(
values = c("Negative" = "#808080",
"Positive" = "#ed5736")
) +
labs(title = "Type 2 marker") +
theme_classic()
pdf(file = "E:/FlowReview/FigQC_forsig/type2.pdf",width = 6,height = 4.5)
print(p)
dev.off()
generate_points <- function(n, mean_x, sd_x, mean_y, sd_y, group_name) {
x <- rnorm(n, mean = mean_x, sd = sd_x)
y <- rnorm(n, mean = mean_y, sd = sd_y)
data.frame(x = x, y = y, Population = group_name)
}
set.seed(42)
group1 <- generate_points(n = 10000, mean_x = 0, sd_x = 100, mean_y = 100, sd_y = 100, group_name = "Negative")
# #type 1
# group2 <- generate_points(n = 1000, mean_x = 700, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
#type 2
group2 <- generate_points(n = 1000, mean_x = 350, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
data <- rbind(group1, group2)
#logicle transform
logicle_x <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
logicle_y <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
data$x_trans <- logicle_x(data$x)
data$y_trans <- logicle_y(data$y)
p = ggplot(data, aes(x = x_trans, y = y_trans, color = Population)) +
geom_point(alpha = 0.5, size = 1) +
scale_x_continuous(
name = "CD25",
breaks = logicle_x(c(-1000, -300, -100, 0, 100, 500, 700, 1000, 2000, 10000)),
labels = c("-1000", "-300",  "-100", "0", "100", "500", "700", "1000", "2000", "10000"),
limits = logicle_x(c(-300, 1000))  # 设置显示范围
) +
scale_y_continuous(
name = "CD127",
breaks = logicle_y(c(-1000, -200, -100, 0, 100, 200, 500, 1000, 5000, 10000)),
labels = c("-1000", "-200", "-100", "0", "100", "200", "500", "1000", "5000", "10000"),
limits = logicle_y(c(-200, 550))    # 设置显示范围
) +
scale_color_manual(
values = c("Negative" = "#808080",
"Positive" = "#ed5736")
) +
labs(title = "Type 2 marker") +
theme_classic()
pdf(file = "E:/FlowReview/FigQC_forsig/type2.pdf",width = 6,height = 4.5)
print(p)
dev.off()
generate_points <- function(n, mean_x, sd_x, mean_y, sd_y, group_name) {
x <- rnorm(n, mean = mean_x, sd = sd_x)
y <- rnorm(n, mean = mean_y, sd = sd_y)
data.frame(x = x, y = y, Population = group_name)
}
set.seed(42)
group1 <- generate_points(n = 10000, mean_x = 0, sd_x = 100, mean_y = 100, sd_y = 100, group_name = "Negative")
# #type 1
# group2 <- generate_points(n = 1000, mean_x = 700, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
#type 2
group2 <- generate_points(n = 1000, mean_x = 400, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
data <- rbind(group1, group2)
#logicle transform
logicle_x <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
logicle_y <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
data$x_trans <- logicle_x(data$x)
data$y_trans <- logicle_y(data$y)
p = ggplot(data, aes(x = x_trans, y = y_trans, color = Population)) +
geom_point(alpha = 0.5, size = 1) +
scale_x_continuous(
name = "CD25",
breaks = logicle_x(c(-1000, -300, -100, 0, 100, 500, 700, 1000, 2000, 10000)),
labels = c("-1000", "-300",  "-100", "0", "100", "500", "700", "1000", "2000", "10000"),
limits = logicle_x(c(-300, 1000))  # 设置显示范围
) +
scale_y_continuous(
name = "CD127",
breaks = logicle_y(c(-1000, -200, -100, 0, 100, 200, 500, 1000, 5000, 10000)),
labels = c("-1000", "-200", "-100", "0", "100", "200", "500", "1000", "5000", "10000"),
limits = logicle_y(c(-200, 550))    # 设置显示范围
) +
scale_color_manual(
values = c("Negative" = "#808080",
"Positive" = "#ed5736")
) +
labs(title = "Type 2 marker") +
theme_classic()
pdf(file = "E:/FlowReview/FigQC_forsig/type2.pdf",width = 6,height = 4.5)
print(p)
dev.off()
generate_points <- function(n, mean_x, sd_x, mean_y, sd_y, group_name) {
x <- rnorm(n, mean = mean_x, sd = sd_x)
y <- rnorm(n, mean = mean_y, sd = sd_y)
data.frame(x = x, y = y, Population = group_name)
}
set.seed(42)
group1 <- generate_points(n = 10000, mean_x = 0, sd_x = 100, mean_y = 100, sd_y = 100, group_name = "Negative")
# #type 1
# group2 <- generate_points(n = 1000, mean_x = 700, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
# #type 2
# group2 <- generate_points(n = 1000, mean_x = 400, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
#type 3
group2 <- generate_points(n = 1000, mean_x = 200, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
data <- rbind(group1, group2)
#logicle transform
logicle_x <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
logicle_y <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
data$x_trans <- logicle_x(data$x)
data$y_trans <- logicle_y(data$y)
p = ggplot(data, aes(x = x_trans, y = y_trans, color = Population)) +
geom_point(alpha = 0.5, size = 1) +
scale_x_continuous(
name = "CD25",
breaks = logicle_x(c(-1000, -300, -100, 0, 100, 500, 700, 1000, 2000, 10000)),
labels = c("-1000", "-300",  "-100", "0", "100", "500", "700", "1000", "2000", "10000"),
limits = logicle_x(c(-300, 1000))  # 设置显示范围
) +
scale_y_continuous(
name = "CD127",
breaks = logicle_y(c(-1000, -200, -100, 0, 100, 200, 500, 1000, 5000, 10000)),
labels = c("-1000", "-200", "-100", "0", "100", "200", "500", "1000", "5000", "10000"),
limits = logicle_y(c(-200, 550))    # 设置显示范围
) +
scale_color_manual(
values = c("Negative" = "#808080",
"Positive" = "#ed5736")
) +
labs(title = "Type 3 marker") +
theme_classic()
pdf(file = "E:/FlowReview/FigQC_forsig/type3.pdf",width = 6,height = 4.5)
print(p)
dev.off()
generate_points <- function(n, mean_x, sd_x, mean_y, sd_y, group_name) {
x <- rnorm(n, mean = mean_x, sd = sd_x)
y <- rnorm(n, mean = mean_y, sd = sd_y)
data.frame(x = x, y = y, Population = group_name)
}
set.seed(42)
group1 <- generate_points(n = 10000, mean_x = 0, sd_x = 100, mean_y = 100, sd_y = 100, group_name = "Negative")
#type 1
group2 <- generate_points(n = 1000, mean_x = 700, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
# #type 2
# group2 <- generate_points(n = 1000, mean_x = 400, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
# #type 3
# group2 <- generate_points(n = 1000, mean_x = 200, sd_x = 100, mean_y = 0, sd_y = 50, group_name = "Positive")
data <- rbind(group1, group2)
#logicle transform
logicle_x <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
logicle_y <- logicleTransform(w = 2, t = 10000, m = 4.5, a = 0)
data$x_trans <- logicle_x(data$x)
data$y_trans <- logicle_y(data$y)
p = ggplot(data, aes(x = x_trans, y = y_trans, color = Population)) +
geom_point(alpha = 0.5, size = 1) +
scale_x_continuous(
name = "CD25",
breaks = logicle_x(c(-1000, -300, -100, 0, 100, 500, 700, 1000, 2000, 10000)),
labels = c("-1000", "-300",  "-100", "0", "100", "500", "700", "1000", "2000", "10000"),
limits = logicle_x(c(-300, 1000))  # 设置显示范围
) +
scale_y_continuous(
name = "CD127",
breaks = logicle_y(c(-1000, -200, -100, 0, 100, 200, 500, 1000, 5000, 10000)),
labels = c("-1000", "-200", "-100", "0", "100", "200", "500", "1000", "5000", "10000"),
limits = logicle_y(c(-200, 550))    # 设置显示范围
) +
scale_color_manual(
values = c("Negative" = "#808080",
"Positive" = "#ed5736")
) +
labs(title = "Type 1 marker") +
theme_classic()
pdf(file = "E:/FlowReview/FigQC_forsig/type1.pdf",width = 6,height = 4.5)
print(p)
dev.off()
library(USERM)
#querySig
Sig_info = querySig()
# Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]
Sig_mtx  = getSigMtx(ids = c(Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]))
SuprObj = CreateUserm(A = Sig_mtx)
#add ResObj into SuprObj
for (save_suf in colnames(Sig_mtx)) {
ResObj = getRes(id = save_suf)
SuprObj = AddRes2Userm(Res = ResObj, Userm = SuprObj)
}
SuprObj[["Scale_df"]][["min"]] = -100
SuprObj[["Scale_df"]][["max"]] = 1000
SuprObj[["Scale_df"]][["scale"]] = "Linear"
SuprObj[["Scale_df"]][["cofactor"]] = 10
#
#
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[1],min = -100, max = 1000, scale = "Linear", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[2],min = -100, max = 1000, scale = "Log10", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[3],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[4],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[1,1] = 100
#' @importFrom MASS ginv
library(MASS)
Userm = SuprObj
detectors = Userm$detectors
fluors = Userm$fluors
A = Userm$A
A = A[detectors, fluors, drop = FALSE]
A_pinv = ginv(A)
colnames(A_pinv) = rownames(A)
rownames(A_pinv) = colnames(A)
#calculate weighted slop
tan_matrix = array(0, dim = c(ncol(A), ncol(A))) #(channel, scc)
for (i in 1:ncol(A)) {
fluor = colnames(A)[i]
slop_matrix = Userm$Res[[fluor]]$slopMtx
slop_matrix = slop_matrix[detectors,detectors]
tan_matrix[,i] = diag((A_pinv %*% slop_matrix) %*% t(A_pinv))
}
colnames(tan_matrix) = colnames(A)
rownames(tan_matrix) = colnames(A)
tan_matrix = t(tan_matrix)
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[1,1] = 10000
PredOneSpread(Userm = SuprObj,population_id = c("V1"))
SuprObj[["Scale_df"]][["max"]] = 20000
PredOneSpread(Userm = SuprObj,population_id = c("V1"))
devtools::document()
devtools::install_github("xiangmingcai/USERM")
library(USERM)
library(USERM)
#querySig
Sig_info = querySig()
# Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]
Sig_mtx  = getSigMtx(ids = c(Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]))
SuprObj = CreateUserm(A = Sig_mtx)
#add ResObj into SuprObj
for (save_suf in colnames(Sig_mtx)) {
ResObj = getRes(id = save_suf)
SuprObj = AddRes2Userm(Res = ResObj, Userm = SuprObj)
}
SuprObj[["Scale_df"]][["min"]] = -100
SuprObj[["Scale_df"]][["max"]] = 20000
SuprObj[["Scale_df"]][["scale"]] = "Linear"
SuprObj[["Scale_df"]][["cofactor"]] = 10
#
#
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[1],min = -100, max = 1000, scale = "Linear", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[2],min = -100, max = 1000, scale = "Log10", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[3],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[4],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[1,1] = 10000
SpreadTangent_mtx = EstimateSpreadTangentMtx(Userm = SuprObj)
Vis_Mtx(mat = SpreadTangent_mtx,mincolor = "darkred",midcolor = "white", maxcolor = "white",max = 1,mid = 0.1,min = 0,title = "Residual based spread (RBS) matrix")
Vis_Mtx(mat = SpreadTangent_mtx,mincolor = "darkred",midcolor = "white", maxcolor = "white",max = 1,mid = 0.1,min = 0,title = "Spread Tangent matrix (STM) (row spread into column)")
Vis_Mtx(mat = SpreadTangent_mtx,mincolor = "white",midcolor = "white", maxcolor = "darkred",max = 1,mid = 0.1,min = 0,title = "Spread Tangent matrix (STM) (row spread into column)")
SuprObj$Intensity_mtx[,1] = 10000
#
#
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[1],min = -100, max = 1000, scale = "Linear", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[2],min = -100, max = 1000, scale = "Log10", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[3],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[4],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[3,1] = 10000
PredOneSpread(Userm = SuprObj,population_id = c("V1"))
Vis_Mtx(mat = SpreadTangent_mtx,mincolor = "white",midcolor = "white", maxcolor = "darkred",max = 2,mid = 1,min = 0,title = "Spread Tangent matrix (STM) (row spread into column)")
#
#
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[1],min = -100, max = 1000, scale = "Linear", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[2],min = -100, max = 1000, scale = "Log10", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[3],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[4],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[23,1] = 10000
PredOneSpread(Userm = SuprObj,population_id = c("V1"))
abs(SpreadTangent_mtx)
sqrt(abs(SpreadTangent_mtx))
devtools::document()
devtools::install_github("xiangmingcai/USERM")
library(USERM)
#querySig
Sig_info = querySig()
# Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]
Sig_mtx  = getSigMtx(ids = c(Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]))
SuprObj = CreateUserm(A = Sig_mtx)
#add ResObj into SuprObj
for (save_suf in colnames(Sig_mtx)) {
ResObj = getRes(id = save_suf)
SuprObj = AddRes2Userm(Res = ResObj, Userm = SuprObj)
}
SuprObj[["Scale_df"]][["min"]] = -100
SuprObj[["Scale_df"]][["max"]] = 20000
SuprObj[["Scale_df"]][["scale"]] = "Linear"
SuprObj[["Scale_df"]][["cofactor"]] = 10
#
#
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[1],min = -100, max = 1000, scale = "Linear", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[2],min = -100, max = 1000, scale = "Log10", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[3],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[4],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[23,1] = 10000
SpreadTangent_mtx = EstimateSpreadTangentMtx(Userm = SuprObj)
Vis_Mtx(mat = SpreadTangent_mtx,mincolor = "white",midcolor = "white", maxcolor = "darkred",max = 2,mid = 1,min = 0,title = "Spread Tangent matrix (STM) (row spread into column)")
library(USERM)
#querySig
Sig_info = querySig()
# Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]
Sig_mtx  = getSigMtx(ids = c(Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]))
SuprObj = CreateUserm(A = Sig_mtx)
#add ResObj into SuprObj
for (save_suf in colnames(Sig_mtx)) {
ResObj = getRes(id = save_suf)
SuprObj = AddRes2Userm(Res = ResObj, Userm = SuprObj)
}
SuprObj[["Scale_df"]][["min"]] = -100
SuprObj[["Scale_df"]][["max"]] = 20000
SuprObj[["Scale_df"]][["scale"]] = "Linear"
SuprObj[["Scale_df"]][["cofactor"]] = 10
#
#
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[1],min = -100, max = 1000, scale = "Linear", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[2],min = -100, max = 1000, scale = "Log10", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[3],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[4],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[23,1] = 10000
SpreadTangent_mtx = EstimateSpreadTangentMtx(Userm = SuprObj)
pdf(file = "E:/ResidualModel/STanmtx.pdf",width = 10,height = 10)
Vis_Mtx(mat = SpreadTangent_mtx,mincolor = "white",midcolor = "white", maxcolor = "darkred",max = 2,mid = 1,min = 0,title = "Spread Tangent matrix (STM) (row spread into column)")
dev.off()
devtools::document()
devtools::install_github("xiangmingcai/USERM")
library(USERM)
#querySig
Sig_info = querySig()
# Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]
Sig_mtx  = getSigMtx(ids = c(Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]))
SuprObj = CreateUserm(A = Sig_mtx)
#add ResObj into SuprObj
for (save_suf in colnames(Sig_mtx)) {
ResObj = getRes(id = save_suf)
SuprObj = AddRes2Userm(Res = ResObj, Userm = SuprObj)
}
SuprObj[["Scale_df"]][["min"]] = -100
SuprObj[["Scale_df"]][["max"]] = 20000
SuprObj[["Scale_df"]][["scale"]] = "Linear"
SuprObj[["Scale_df"]][["cofactor"]] = 10
#
#
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[1],min = -100, max = 1000, scale = "Linear", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[2],min = -100, max = 1000, scale = "Log10", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[3],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[4],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[23,1] = 10000
SpreadTangent_mtx = EstimateSpreadTangentMtx(Userm = SuprObj)
pdf(file = "E:/ResidualModel/STanmtx.pdf",width = 10,height = 10)
Vis_Mtx(mat = SpreadTangent_mtx,mincolor = "white",midcolor = "white", maxcolor = "#ff7500",max = 2,mid = 1,min = 0,title = "Spread Tangent matrix (STM) (row spread into column)")
dev.off()
pdf(file = "E:/ResidualModel/STanmtx.pdf",width = 10,height = 10)
Vis_Mtx(mat = SpreadTangent_mtx,mincolor = "white",midcolor = "white", maxcolor = "#ff7500",
max = 2,mid = 1,min = 0,legend_name = "Tangent",
title = "Spread Tangent matrix (STM) (row spread into column)")
dev.off()
library(USERM)
#querySig
Sig_info = querySig()
# Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]
Sig_mtx  = getSigMtx(ids = c(Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]))
SuprObj = CreateUserm(A = Sig_mtx)
#add ResObj into SuprObj
for (save_suf in colnames(Sig_mtx)) {
ResObj = getRes(id = save_suf)
SuprObj = AddRes2Userm(Res = ResObj, Userm = SuprObj)
}
SuprObj[["Scale_df"]][["min"]] = -100
SuprObj[["Scale_df"]][["max"]] = 20000
SuprObj[["Scale_df"]][["scale"]] = "Linear"
SuprObj[["Scale_df"]][["cofactor"]] = 10
#
#
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[1],min = -100, max = 1000, scale = "Linear", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[2],min = -100, max = 1000, scale = "Log10", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[3],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[4],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[23,1] = 10000
View(SuprObj)
SpreadTangent_mtx = EstimateSpreadTangentMtx(Userm = SuprObj)
Vis_Mtx(mat = SpreadTangent_mtx,mincolor = "white",midcolor = "white", maxcolor = "#ff7500",
max = 2,mid = 1,min = 0,legend_name = "Tangent",
title = "Spread Tangent matrix (STM) (row spread into column)")
EstimateHotspotMtx = function(Userm){
detectors = Userm$detectors
fluors = Userm$fluors
A = Userm$A
A = A[detectors, fluors, drop = FALSE]
A_pinv = ginv(A)
colnames(A_pinv) = rownames(A)
rownames(A_pinv) = colnames(A)
H_mtx = sqrt(abs(A_pinv))
return(H_mtx)
}
Hotspot_mtx = EstimateHotspotMtx(Userm = SuprObj)
library(MASS)
Hotspot_mtx = EstimateHotspotMtx(Userm = SuprObj)
Hotspot_mtx
Vis_Mtx(mat = Hotspot_mtx,mincolor = "white",midcolor = "white", maxcolor = "#ff7500",
max = 20,mid = 10,min = 0,legend_name = "Hotspot",
title = "Hotspot matrix")
Vis_Mtx(mat = Hotspot_mtx,mincolor = "white",midcolor = "white", maxcolor = "#ff7500",
max = 2,mid = 1,min = 0,legend_name = "Hotspot",
title = "Hotspot matrix")
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::install_github("xiangmingcai/USERM")
library(USERM)
#querySig
Sig_info = querySig()
# Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]
Sig_mtx  = getSigMtx(ids = c(Sig_info$id[c(32:38,41:42,44,46:48,50:54,58:62,8,9,12,14,18,24,25,26,63)]))
SuprObj = CreateUserm(A = Sig_mtx)
#add ResObj into SuprObj
for (save_suf in colnames(Sig_mtx)) {
ResObj = getRes(id = save_suf)
SuprObj = AddRes2Userm(Res = ResObj, Userm = SuprObj)
}
SuprObj[["Scale_df"]][["min"]] = -100
SuprObj[["Scale_df"]][["max"]] = 20000
SuprObj[["Scale_df"]][["scale"]] = "Linear"
SuprObj[["Scale_df"]][["cofactor"]] = 10
#
#
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[1],min = -100, max = 1000, scale = "Linear", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[2],min = -100, max = 1000, scale = "Log10", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[3],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
# SuprObj = AddScale(Userm = SuprObj,fluor = colnames(Sig_mtx)[4],min = -100, max = 1000, scale = "Arcsinh", cofactor = 10)# c("Linear","Log10","Arcsinh")
SuprObj$Intensity_mtx[,1] = 0*c(1:length(SuprObj$fluors))
SuprObj$Intensity_mtx[23,1] = 10000
Coef_mtx = EstimateCoefMtx(Userm = SuprObj)
pdf(file = "E:/ResidualModel/CoefMtx.pdf",width = 10,height = 10)
Vis_Mtx(mat = Coef_mtx,mincolor = "white",midcolor = "white", maxcolor = "#ff7500",
max = 2,mid = 1,min = 0,legend_name = "Coef",
title = "Coefficient of residual model matrix (Coef Matrix) (row spread into column)")
dev.off()
Hotspot_mtx = EstimateHotspotMtx(Userm = SuprObj)
pdf(file = "E:/ResidualModel/HotspotMtx.pdf",width = 10,height = 10)
Vis_Mtx(mat = Hotspot_mtx,mincolor = "white",midcolor = "white", maxcolor = "#ff7500",
max = 2,mid = 1,min = 0,legend_name = "Hotspot",
title = "Hotspot matrix")
dev.off()
Userm = SuprObj
detectors = Userm$detectors
fluors = Userm$fluors
A = Userm$A
A = A[detectors, fluors, drop = FALSE]
H_mtx = (t(A) %*% A)
H_mtx = ginv(H_mtx)
library(MASS)
H_mtx = ginv(H_mtx)
H_mtx = sqrt(abs(H_mtx))
View(H_mtx)
devtools::document()
